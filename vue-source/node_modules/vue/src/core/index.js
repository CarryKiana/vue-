import Vue from './instance/index'
import { initGlobalAPI } from './global-api/index'
import { isServerRendering } from 'core/util/env'
import { FunctionalRenderContext } from 'core/vdom/create-functional-component'
// 初始化全局api，即为Vue类拓展全局属性和方法
initGlobalAPI(Vue)
// 在Vue类的原型上定义 $isServer 属性，这样每个新建的vue实例上都有这个属性，用来判断此vue实例是否运行于服务器端
Object.defineProperty(Vue.prototype, '$isServer', {
  get: isServerRendering
})
// 在Vue类的原型上定义 $ssrContext 属性，若是ssr并且虚拟节点$vnode存在，则返回ssr上下文，否则返回false
Object.defineProperty(Vue.prototype, '$ssrContext', {
  get () {
    /* istanbul ignore next */
    return this.$vnode && this.$vnode.ssrContext
  }
})

// expose FunctionalRenderContext for ssr runtime helper installation
// 为ssr运行时暴露出函数渲染上下文
Object.defineProperty(Vue, 'FunctionalRenderContext', {
  value: FunctionalRenderContext
})
// 当前Vue版本号
Vue.version = '__VERSION__'
// 导出Vue类
export default Vue
